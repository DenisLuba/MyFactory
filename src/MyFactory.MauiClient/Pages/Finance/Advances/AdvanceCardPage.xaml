<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
	x:Class="MyFactory.MauiClient.Pages.Finance.Advances.AdvanceCardPage"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
	xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Finance.Advances"
	xmlns:models="clr-namespace:MyFactory.MauiClient.Models.Finance"
	x:DataType="view_model:AdvanceCardPageViewModel"
	Title="Карточка выдачи">

	<ScrollView>
		<VerticalStackLayout Padding="16" Spacing="16">
			
			<!-- Основная информация -->
			<Frame BorderColor="LightGray" CornerRadius="8" Padding="12">
				<VerticalStackLayout Spacing="12">
					<Label Text="Основная информация" FontSize="18" FontAttributes="Bold" />
					
					<Grid ColumnDefinitions="150,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="8">
						<!-- Номер выдачи -->
						<Label Text="Номер выдачи:" VerticalOptions="Center" />
						<Label Grid.Column="1" Text="{Binding Advance.AdvanceNumber}" FontAttributes="Bold" VerticalOptions="Center" />
						
						<!-- Дата выдачи -->
						<Label Grid.Row="1" Text="Дата выдачи:" VerticalOptions="Center" />
						<Label Grid.Row="1" Grid.Column="1" Text="{Binding Advance.Date}" VerticalOptions="Center" />
						
						<!-- Сотрудник -->
						<Label Grid.Row="2" Text="Сотрудник:" VerticalOptions="Center" />
						<Label Grid.Row="2" Grid.Column="1" Text="{Binding Advance.Employee}" VerticalOptions="Center" />
						
						<!-- Сумма выдана -->
						<Label Grid.Row="3" Text="Сумма выдана:" VerticalOptions="Center" />
						<Label Grid.Row="3" Grid.Column="1" Text="{Binding Advance.AdvanceAmount, StringFormat='{0:N0} ₽'}" FontSize="16" FontAttributes="Bold" TextColor="Green" VerticalOptions="Center" />
						
						<!-- Статус -->
						<Label Grid.Row="4" Text="Статус:" VerticalOptions="Center" />
						<Label Grid.Row="4" Grid.Column="1" Text="{Binding Advance.Status}" VerticalOptions="Center" />
					</Grid>
					
					<!-- Комментарий -->
					<Label Text="Комментарий:" />
					<Editor Text="{Binding Comment}" HeightRequest="80" IsReadOnly="True" />
				</VerticalStackLayout>
			</Frame>

			<!-- Блок "Отчёт работника" (если есть) -->
			<Frame BorderColor="LightGray" CornerRadius="8" Padding="12" IsVisible="{Binding HasReport}">
				<VerticalStackLayout Spacing="12">
					<Label Text="Отчёт работника" FontSize="18" FontAttributes="Bold" />
					
					<!-- Таблица расходов -->
					<CollectionView ItemsSource="{Binding ReportItems}" SelectionMode="None">
						<CollectionView.Header>
							<Grid ColumnDefinitions="*,100,100,*" Padding="0,0,0,8" BackgroundColor="LightGray">
								<Label Text="Статья расхода" FontAttributes="Bold" Margin="4,0" />
								<Label Text="Дата" FontAttributes="Bold" Grid.Column="1" Margin="4,0" />
								<Label Text="Сумма" FontAttributes="Bold" Grid.Column="2" Margin="4,0" />
								<Label Text="Категория" FontAttributes="Bold" Grid.Column="3" Margin="4,0" />
							</Grid>
						</CollectionView.Header>
						<CollectionView.ItemTemplate>
							<DataTemplate x:DataType="models:AdvanceReportItem">
								<Grid ColumnDefinitions="*,100,100,*" Padding="4,8">
									<Label Text="{Binding ItemName}" VerticalOptions="Center" />
									<Label Text="{Binding Amount, StringFormat='{0:N0} ₽'}" Grid.Column="2" VerticalOptions="Center" />
									<Label Text="{Binding Category}" Grid.Column="3" VerticalOptions="Center" />
								</Grid>
							</DataTemplate>
						</CollectionView.ItemTemplate>
					</CollectionView>
					
					<!-- Итоги -->
					<BoxView HeightRequest="1" Color="LightGray" />
					<Grid ColumnDefinitions="150,*" RowSpacing="8">
						<Label Text="Всего израсходовано:" FontAttributes="Bold" />
						<Label Grid.Column="1" Text="{Binding TotalSpent, StringFormat='{0:N0} ₽'}" FontAttributes="Bold" TextColor="Red" />
						
						<Label Grid.Row="1" Text="Остаток/Перерасход:" FontAttributes="Bold" />
						<Label Grid.Row="1" Grid.Column="1" Text="{Binding Balance, StringFormat='{0:N0} ₽'}" FontAttributes="Bold" />
					</Grid>
				</VerticalStackLayout>
			</Frame>

			<!-- Действия -->
			<VerticalStackLayout Spacing="8">
				<Button Text="Добавить отчёт" Command="{Binding AddReportCommand}" 
						IsVisible="{Binding HasReport, Converter={StaticResource InvertedBoolConverter}}" />
				
				<HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
					<Button Text="Редактировать" Command="{Binding EditAdvanceCommand}" />
					<Button Text="Закрыть выдачу" Command="{Binding CloseAdvanceCommand}" 
							BackgroundColor="Orange" TextColor="White" />
					<Button Text="Удалить" Command="{Binding DeleteAdvanceCommand}" 
							BackgroundColor="Red" TextColor="White" />
				</HorizontalStackLayout>
			</VerticalStackLayout>

		</VerticalStackLayout>
	</ScrollView>
</ContentPage>
