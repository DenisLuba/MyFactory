<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Finance.Overheads.OverheadCardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:MyFactory.MauiClient.Converters"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Finance.Overheads"
    x:DataType="view_model:OverheadCardPageViewModel"
    Title="Карточка расхода">

    <ContentPage.Resources>
        <Color x:Key="TextSecondaryColor">#6B7280</Color>
        <Color x:Key="PrimaryColor">#2563EB</Color>
        <Color x:Key="ErrorColor">#DC2626</Color>

        <Style x:Key="CaptionLabelStyle" TargetType="Label">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextColor" Value="{StaticResource TextSecondaryColor}" />
        </Style>

        <Style x:Key="CardFrameStyle" TargetType="Frame">
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="HasShadow" Value="False" />
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#FFFFFF, Dark=#1F2937}" />
            <Setter Property="BorderColor" Value="{AppThemeBinding Light=#E5E7EB, Dark=#374151}" />
        </Style>

        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Сохранить" Command="{Binding SaveCommand}" />
    </ContentPage.ToolbarItems>

    <Grid Padding="16">
        <ScrollView>
            <VerticalStackLayout Spacing="16">
                <Frame Style="{StaticResource CardFrameStyle}">
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Статус" Style="{StaticResource CaptionLabelStyle}" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="20"
                            Text="{Binding Status}" />
                        <Label
                            FontSize="12"
                            Text="{Binding ExpenseDate, StringFormat='{}{0:dd MMMM yyyy}'}"
                            TextColor="{StaticResource TextSecondaryColor}" />
                    </VerticalStackLayout>
                </Frame>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Дата" Style="{StaticResource CaptionLabelStyle}" />
                    <DatePicker
                        Date="{Binding ExpenseDate}"
                        IsEnabled="{Binding IsEditMode}" />
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Статья" Style="{StaticResource CaptionLabelStyle}" />
                    <Picker
                        IsEnabled="{Binding IsEditMode}"
                        ItemsSource="{Binding Articles}"
                        SelectedItem="{Binding Article}"
                        Title="Выберите статью" />
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Сумма" Style="{StaticResource CaptionLabelStyle}" />
                    <Entry
                        IsEnabled="{Binding IsEditMode}"
                        Keyboard="Numeric"
                        Placeholder="0,00"
                        Text="{Binding Amount}" />
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label Text="Комментарий" Style="{StaticResource CaptionLabelStyle}" />
                    <Editor
                        HeightRequest="120"
                        IsEnabled="{Binding IsEditMode}"
                        Placeholder="Добавьте пояснение"
                        Text="{Binding Comment}" />
                </VerticalStackLayout>

                <HorizontalStackLayout Spacing="12">
                    <Button
                        Command="{Binding SaveCommand}"
                        HorizontalOptions="FillAndExpand"
                        IsEnabled="{Binding IsEditMode}"
                        Text="Сохранить" />
                    <Button
                        Command="{Binding EnableEditingCommand}"
                        HorizontalOptions="FillAndExpand"
                        IsVisible="{Binding IsEditMode, Converter={StaticResource InvertedBoolConverter}}"
                        Text="Редактировать" />
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="12">
                    <Button
                        Command="{Binding PostCommand}"
                        HorizontalOptions="FillAndExpand"
                        Text="Провести" />
                    <Button
                        Command="{Binding DeleteCommand}"
                        HorizontalOptions="FillAndExpand"
                        Text="Удалить"
                        TextColor="{StaticResource ErrorColor}" />
                </HorizontalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <ActivityIndicator
            HorizontalOptions="Center"
            IsRunning="{Binding IsBusy}"
            IsVisible="{Binding IsBusy}"
            InputTransparent="True"
            VerticalOptions="Center" />
    </Grid>
</ContentPage>
