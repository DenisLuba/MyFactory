<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Reference.Workshops.WorkshopExpenseCardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:converters="clr-namespace:MyFactory.MauiClient.Converters"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Reference.Workshops"
    x:DataType="view_model:WorkshopExpenseCardPageViewModel"
    Title="Расход цеха">

    <ContentPage.Resources>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        <converters:DecimalToStringConverter x:Key="DecimalToStringConverter" />
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Stroke" Value="{AppThemeBinding Light=#E5E7EB, Dark=#374151}" />
            <Setter Property="Background" Value="{AppThemeBinding Light=#FFFFFF, Dark=#1F2937}" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="12" />
                </Setter.Value>
            </Setter>
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="16,0,16,16" />
        </Style>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Сохранить" Command="{Binding SaveExpenseCommand}" Priority="0" Order="Primary" />
    </ContentPage.ToolbarItems>

    <RefreshView Command="{Binding LoadExpenseCommand}" IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="0,16" Spacing="16">
                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center" VerticalOptions="Center">
                    <Label FontAttributes="Bold" FontSize="20" Text="Цеховой расход" />
                    <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />
                </HorizontalStackLayout>

                <Border Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="12">
                        <VerticalStackLayout>
                            <Label Text="Цех" FontAttributes="Bold" />
                            <Picker
                                ItemsSource="{Binding Workshops}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedWorkshop}" />
                        </VerticalStackLayout>

                        <VerticalStackLayout>
                            <Label Text="Сумма за единицу" FontAttributes="Bold" />
                            <Entry
                                Keyboard="Numeric"
                                Placeholder="0"
                                Text="{Binding AmountPerUnit, Converter={StaticResource DecimalToStringConverter}}" />
                        </VerticalStackLayout>

                        <VerticalStackLayout>
                            <Label Text="Дата начала" FontAttributes="Bold" />
                            <DatePicker Date="{Binding EffectiveFrom}" />
                        </VerticalStackLayout>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" VerticalOptions="Center">
                            <Label Text="Указать дату окончания" />
                            <Switch Grid.Column="1" IsToggled="{Binding HasEffectiveTo}" HorizontalOptions="End" />
                        </Grid>

                        <VerticalStackLayout>
                            <Label Text="Дата окончания" FontAttributes="Bold" />
                            <DatePicker Date="{Binding EffectiveTo}" IsEnabled="{Binding HasEffectiveTo}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <Button
                    Margin="16,0"
                    Text="Сохранить"
                    Command="{Binding SaveExpenseCommand}"
                    IsEnabled="{Binding IsSaving, Converter={StaticResource InvertedBoolConverter}}" />
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
