<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
	x:Class="MyFactory.MauiClient.Pages.Reference.Products.ProductsTablePage"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
	xmlns:ui="clr-namespace:MyFactory.MauiClient.UIModels.Reference"
	xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Reference.Products"
	Title="Изделия (справочник)"
	x:DataType="view_model:ProductsTablePageViewModel">

	<Grid
		Padding="16"
		RowDefinitions="Auto,*"
		RowSpacing="12">
		<Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
			<HorizontalStackLayout Spacing="12" VerticalOptions="Center">
				<Label
					FontAttributes="Bold"
					FontSize="18"
					Text="Список изделий"
					VerticalTextAlignment="Center" />
				<Label
					Text="{Binding Products.Count, StringFormat='Всего: {0}'}"
					TextColor="{DynamicResource Gray500}"
					VerticalTextAlignment="Center" />
				<ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />
			</HorizontalStackLayout>
			<Button
				Grid.Column="1"
				Command="{Binding LoadCommand}"
				IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
				Text="Обновить" />
		</Grid>

		<RefreshView
			Grid.Row="1"
			Command="{Binding RefreshCommand}"
			IsRefreshing="{Binding IsBusy}">
			<CollectionView
				ItemsSource="{Binding Products}"
				SelectionChanged="OnProductSelectionChanged"
				SelectionMode="Single">
				<CollectionView.EmptyView>
					<Label
						Padding="24"
						HorizontalOptions="Center"
						Text="Изделия не найдены"
						TextColor="{DynamicResource Gray500}" />
				</CollectionView.EmptyView>
				<CollectionView.ItemTemplate>
					<DataTemplate x:DataType="ui:ProductItem">
						<Border>
							<Grid
								ColumnDefinitions="Auto,*,Auto"
								ColumnSpacing="12"
								RowDefinitions="Auto,Auto"
								RowSpacing="6">
								<Label FontAttributes="Bold" Text="{Binding Sku}" />
								<Label
									Grid.Column="1"
									FontAttributes="Bold"
									FontSize="16"
									Text="{Binding Name}" />
								<Label
									Grid.Column="2"
									HorizontalTextAlignment="End"
									Text="{Binding Status}" />

								<StackLayout
									Grid.Row="1"
									Grid.ColumnSpan="3"
									Orientation="Horizontal"
									Spacing="16">
									<Label Text="{Binding PlanPerHour, StringFormat='План: {0:0.##}/ч'}" />
									<Label Text="{Binding ImageCount, StringFormat='Картинок: {0}'}" />
								</StackLayout>
							</Grid>
						</Border>
					</DataTemplate>
				</CollectionView.ItemTemplate>
			</CollectionView>
		</RefreshView>
	</Grid>
</ContentPage>
