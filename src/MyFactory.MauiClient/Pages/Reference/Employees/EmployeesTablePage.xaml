<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Reference.Employees.EmployeesTablePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Reference.Employees"
    xmlns:models="clr-namespace:MyFactory.MauiClient.Models.Employees"
    x:DataType="view_model:EmployeesTablePageViewModel"
    Title="Сотрудники">

    <VerticalStackLayout Padding="16" Spacing="12">

        <VerticalStackLayout Spacing="6">
            <Label Text="Фильтры" FontAttributes="Bold" />
            <Grid ColumnDefinitions="* Auto" ColumnSpacing="8">
                <Entry
                    Grid.Column="0"
                    Placeholder="Должность или роль"
                    Text="{Binding RoleFilter, Mode=TwoWay}" />
                <Button
                    Grid.Column="1"
                    Text="Обновить"
                    Command="{Binding LoadCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}" />
            </Grid>
        </VerticalStackLayout>

        <RefreshView Command="{Binding LoadCommand}" IsRefreshing="{Binding IsBusy}">
            <CollectionView
                ItemsSource="{Binding Employees}"
                SelectionMode="Single"
                SelectionChanged="OnEmployeeSelectionChanged">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:EmployeeListResponse">
                        <Grid ColumnDefinitions="2*,2*,Auto" Padding="10" ColumnSpacing="8">
                            <VerticalStackLayout>
                                <Label Text="{Binding FullName}" />
                                <Label
                                    Text="{Binding Position}"
                                    FontSize="12"
                                    TextColor="{DynamicResource Gray400}" />
                            </VerticalStackLayout>
                            <Label
                                Grid.Column="1"
                                Text="{Binding Grade, StringFormat='Разряд: {0}'}"
                                HorizontalTextAlignment="Start" />
                            <Label
                                Grid.Column="2"
                                Text="{Binding IsActive, Converter={StaticResource BooleanToActiveStatusConverter}}"
                                HorizontalTextAlignment="End"
                                FontAttributes="Bold" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <Label
            Text="Нет сотрудников"
            HorizontalOptions="Center"
            TextColor="{DynamicResource Gray400}"
            IsVisible="{Binding HasNoEmployees}" />

    </VerticalStackLayout>
</ContentPage>
