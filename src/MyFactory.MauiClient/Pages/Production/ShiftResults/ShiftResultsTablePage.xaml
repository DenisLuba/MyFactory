<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Production.ShiftResults.ShiftResultsTablePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Production.ShiftResults"
    xmlns:models="clr-namespace:MyFactory.MauiClient.Models.Shifts"
    x:DataType="view_model:ShiftResultsTablePageViewModel"
    Title="Фактическая сдача">

    <RefreshView
        Command="{Binding LoadCommand}"
        IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="12">
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <DatePicker
                        Grid.Column="0"
                        Date="{Binding SelectedDate}"
                        HorizontalOptions="Fill" />
                    <Entry
                        Grid.Column="1"
                        Text="{Binding EmployeeId}"
                        Placeholder="EmployeeId"
                        Keyboard="Chat"
                        ReturnType="Go"
                        ReturnCommand="{Binding LoadCommand}" />
                </Grid>

                <Grid>
                    <CollectionView
                        ItemsSource="{Binding Results}"
                        SelectionMode="Single"
                        SelectionChanged="OnResultSelectionChanged">
                        <CollectionView.Header>
                            <Grid
                                ColumnDefinitions="2*,2*,Auto,Auto,Auto"
                                Padding="6"
                                BackgroundColor="{DynamicResource SecondaryColor}"
                                Margin="0,0,0,6">
                                <Label Text="Сотрудник" TextColor="White" FontAttributes="Bold" />
                                <Label Grid.Column="1" Text="Изделие" TextColor="White" FontAttributes="Bold" />
                                <Label Grid.Column="2" Text="Факт" TextColor="White" FontAttributes="Bold" HorizontalTextAlignment="End" />
                                <Label Grid.Column="3" Text="Часы" TextColor="White" FontAttributes="Bold" HorizontalTextAlignment="End" />
                                <Label Grid.Column="4" Text="Премия" TextColor="White" FontAttributes="Bold" HorizontalTextAlignment="End" />
                            </Grid>
                        </CollectionView.Header>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:ShiftResultListResponse">
                                <Grid ColumnDefinitions="2*,2*,Auto,Auto,Auto" Padding="6" ColumnSpacing="8">
                                    <VerticalStackLayout>
                                        <Label Text="{Binding EmployeeName}" />
                                        <Label Text="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}" FontSize="12" TextColor="{DynamicResource Gray400}" />
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" Text="{Binding SpecificationName}" />
                                    <Label Grid.Column="2" Text="{Binding ActualQty}" HorizontalTextAlignment="End" />
                                    <Label Grid.Column="3" Text="{Binding HoursWorked}" HorizontalTextAlignment="End" />
                                    <Label Grid.Column="4" Text="{Binding Bonus, Converter={StaticResource BooleanToYesNoConverter}}" HorizontalTextAlignment="End" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Label
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Text="Нет данных по фактической сдаче"
                        TextColor="{DynamicResource Gray400}"
                        IsVisible="{Binding HasNoResults}" />
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
