<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Production.Materials.MaterialTransferTablePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Production.Materials"
    x:DataType="view_model:MaterialTransferTablePageViewModel"
    Title="Передача материалов">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="+" Command="{Binding CreateCommand}" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,*" Padding="16" RowSpacing="12">
        <VerticalStackLayout Spacing="12">
            <Label Text="Фильтры" FontAttributes="Bold" FontSize="14" />

            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Склад" FontSize="12" />
                    <Entry Text="{Binding WarehouseFilter}" Placeholder="Основной" />
                </VerticalStackLayout>
                <VerticalStackLayout Spacing="4">
                    <Label Text="Производственный заказ" FontSize="12" />
                    <Entry Text="{Binding ProductionOrderFilter}" Placeholder="PO-15" />
                </VerticalStackLayout>
            </Grid>

            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" VerticalOptions="Center">
                <StackLayout Orientation="Horizontal" Spacing="6" VerticalOptions="Center">
                    <Label Text="По дате" VerticalOptions="Center" />
                    <Switch IsToggled="{Binding IsDateFilterActive}" />
                </StackLayout>
                <DatePicker Date="{Binding DateFilter}" IsEnabled="{Binding IsDateFilterActive}" />
                <Button Text="Сбросить" Command="{Binding ClearFiltersCommand}" />
            </Grid>
        </VerticalStackLayout>

        <RefreshView Grid.Row="1" Command="{Binding LoadCommand}" IsRefreshing="{Binding IsBusy}">
            <CollectionView
                Margin="0,8,0,0"
                ItemsSource="{Binding Transfers}"
                SelectionMode="Single"
                SelectionChanged="OnTransferSelectionChanged">
                <CollectionView.EmptyView>
                    <Label
                        Margin="0,16,0,0"
                        HorizontalOptions="Center"
                        Text="Документы не найдены"
                        TextColor="{DynamicResource Gray500}"
                        VerticalOptions="Start" />
                </CollectionView.EmptyView>
                <CollectionView.Header>
                    <Grid ColumnDefinitions="*,*,*,*,*" Padding="0,0,0,4">
                        <Label Text="Документ" FontAttributes="Bold" />
                        <Label Text="Дата" Grid.Column="1" FontAttributes="Bold" />
                        <Label Text="Заказ" Grid.Column="2" FontAttributes="Bold" />
                        <Label Text="Склад" Grid.Column="3" FontAttributes="Bold" />
                        <Label Text="Сумма" Grid.Column="4" FontAttributes="Bold" HorizontalTextAlignment="End" />
                    </Grid>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="*,*,*,*,*" Padding="0,4">
                            <Label Text="{Binding DocumentNumber}" />
                            <Label Text="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}" Grid.Column="1" />
                            <Label Text="{Binding ProductionOrder}" Grid.Column="2" />
                            <Label Text="{Binding Warehouse}" Grid.Column="3" />
                            <Label
                                Text="{Binding TotalAmount, StringFormat='{}{0:N0} ₽'}"
                                Grid.Column="4"
                                HorizontalTextAlignment="End" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>
