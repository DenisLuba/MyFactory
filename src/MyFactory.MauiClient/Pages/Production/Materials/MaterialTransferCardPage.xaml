<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Production.Materials.MaterialTransferCardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Production.Materials"
    x:DataType="view_model:MaterialTransferCardPageViewModel"
    Title="Передача материалов">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <Border BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1F1F1F}" Padding="16">
                <VerticalStackLayout Spacing="6">
                    <Label Text="{Binding Transfer.DocumentNumber}" FontAttributes="Bold" FontSize="24" />
                    <Label Text="{Binding Transfer.ProductionOrder, StringFormat='Заказ: {0}'}" />
                    <Label Text="{Binding Transfer.Warehouse, StringFormat='Склад: {0}'}" />
                    <Label Text="{Binding Transfer.Date, StringFormat='Дата: {0:dd.MM.yyyy}'}" />
                    <Label Text="{Binding Transfer.Status, StringFormat='Статус: {0}'}" />
                    <Label Text="{Binding Transfer.TotalAmount, StringFormat='Сумма: {0:N0} ₽'}" />
                </VerticalStackLayout>
            </Border>

            <CollectionView ItemsSource="{Binding Transfer.Items}" IsVisible="{Binding HasTransfer}">
                <CollectionView.Header>
                    <Grid ColumnDefinitions="2*,*,*,*,*" Padding="0,0,0,4">
                        <Label Text="Материал" FontAttributes="Bold" />
                        <Label Text="Кол-во" Grid.Column="1" FontAttributes="Bold" HorizontalTextAlignment="Center" />
                        <Label Text="Ед." Grid.Column="2" FontAttributes="Bold" HorizontalTextAlignment="Center" />
                        <Label Text="Цена" Grid.Column="3" FontAttributes="Bold" HorizontalTextAlignment="End" />
                        <Label Text="Сумма" Grid.Column="4" FontAttributes="Bold" HorizontalTextAlignment="End" />
                    </Grid>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="2*,*,*,*,*" Padding="0,4">
                            <Label Text="{Binding MaterialName}" />
                            <Label Text="{Binding Quantity}" Grid.Column="1" HorizontalTextAlignment="Center" />
                            <Label Text="{Binding Unit}" Grid.Column="2" HorizontalTextAlignment="Center" />
                            <Label Text="{Binding Price, StringFormat='{}{0:N2}'}" Grid.Column="3" HorizontalTextAlignment="End" />
                            <Label Text="{Binding LineTotal, StringFormat='{}{0:N2}'}" Grid.Column="4" HorizontalTextAlignment="End" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label
                Text="Документ не найден"
                HorizontalOptions="Center"
                IsVisible="{Binding HasNoTransfer}" />

            <Button
                Text="Провести документ"
                Command="{Binding SubmitCommand}"
                IsEnabled="{Binding CanSubmit}"
                IsVisible="{Binding HasTransfer}"
                BackgroundColor="ForestGreen"
                TextColor="White" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
