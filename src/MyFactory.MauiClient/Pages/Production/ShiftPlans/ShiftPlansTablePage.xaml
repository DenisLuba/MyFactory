<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Production.ShiftPlans.ShiftPlansTablePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Production.ShiftPlans"
    xmlns:models="clr-namespace:MyFactory.MauiClient.Models.Shifts"
    x:DataType="view_model:ShiftPlansTablePageViewModel"
    Title="Сменные задания">

    <RefreshView
        Command="{Binding LoadCommand}"
        IsRefreshing="{Binding IsBusy}">
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="12">
                <DatePicker Date="{Binding SelectedDate}" />

                <Grid>
                    <CollectionView
                        ItemsSource="{Binding Plans}"
                        SelectionMode="Single"
                        SelectionChanged="OnPlanSelectionChanged">
                        <CollectionView.Header>
                            <Grid
                                ColumnDefinitions="2*,2*,*,*"
                                Padding="6"
                                BackgroundColor="{DynamicResource SecondaryColor}"
                                Margin="0,0,0,6">
                                <Label Text="Сотрудник" TextColor="White" FontAttributes="Bold" />
                                <Label Grid.Column="1" Text="Изделие" TextColor="White" FontAttributes="Bold" />
                                <Label Grid.Column="2" Text="Дата" TextColor="White" FontAttributes="Bold" HorizontalTextAlignment="Center" />
                                <Label Grid.Column="3" Text="План" TextColor="White" FontAttributes="Bold" HorizontalTextAlignment="End" />
                            </Grid>
                        </CollectionView.Header>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:ShiftPlanListResponse">
                                <Grid ColumnDefinitions="2*,2*,*,*" Padding="6" ColumnSpacing="8">
                                    <Label Text="{Binding EmployeeName}" />
                                    <Label Grid.Column="1" Text="{Binding SpecificationName}" />
                                    <Label Grid.Column="2" Text="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}" HorizontalTextAlignment="Center" />
                                    <Label Grid.Column="3" Text="{Binding PlannedQuantity}" HorizontalTextAlignment="End" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Label
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Text="Нет сменных заданий"
                        TextColor="{DynamicResource Gray400}"
                        IsVisible="{Binding HasNoPlans}" />
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
