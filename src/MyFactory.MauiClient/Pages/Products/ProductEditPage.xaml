<ContentPage
	x:Class="MyFactory.MauiClient.Pages.Products.ProductEditPage"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
	xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Products"
	x:Name="ProductEditPageRoot"
	Title="Редактирование товара"
	x:DataType="view_model:ProductEditPageViewModel">

	<Grid
		Padding="16"
		RowDefinitions="Auto,Auto,*,*"
		RowSpacing="12">
		<HorizontalStackLayout Grid.Row="0" Spacing="8">
			<Button Command="{Binding CancelCommand}" Text="Отмена" />
			<Button Command="{Binding SaveCommand}" Text="Сохранить" />
		</HorizontalStackLayout>

		<Grid
			Grid.Row="1"
			ColumnDefinitions="Auto,*"
			ColumnSpacing="8"
			RowDefinitions="0.5*,0.5*"
			RowSpacing="8">
			<Label
				FontAttributes="Bold"
				Text="Название:"
				VerticalTextAlignment="Center" />
			<Entry
				Grid.Column="1"
				Placeholder="Название"
				Text="{Binding Name}" />
			<Label
				Grid.Row="1"
				FontAttributes="Bold"
				Text="План/час:"
				VerticalTextAlignment="Center" />
			<Entry
				Grid.Row="1"
				Grid.Column="1"
				Keyboard="Numeric"
				Placeholder="План/час"
				Text="{Binding PlanPerHour}" />
		</Grid>

		<Border
			Grid.Row="2"
			Padding="8"
			Stroke="LightGray"
			StrokeThickness="1">
			<Grid RowDefinitions="Auto,*" RowSpacing="8">
				<Grid
					Grid.Row="0"
					ColumnDefinitions="0.8*,0.05*,0.05*,0.01*"
					ColumnSpacing="8">
					<Label FontAttributes="Bold" Text="СПЕЦИФИКАЦИЯ" />
					<Button
						Grid.Column="1"
						Command="{Binding AddMaterialCommand}"
						Text="+" />
					<Button
						Grid.Column="2"
						Command="{Binding RemoveMaterialCommand}"
						IsEnabled="{Binding AreMaterialsSelected}"
						IsVisible="{Binding AreMaterialsSelected}"
						Text="-" />
				</Grid>
				<Border Grid.Row="1">
					<CollectionView
						x:Name="BomEditCollection"
						ItemsSource="{Binding EditableBom}"
						SelectionMode="None">
						<CollectionView.Header>
							<Grid
								Padding="0,4"
								ColumnDefinitions="0.7*,0.3*"
								ColumnSpacing="8">
								<Label FontAttributes="Bold" Text="Материал" />
								<Label
									Grid.Column="1"
									FontAttributes="Bold"
									HorizontalTextAlignment="End"
									Text="Количество" />
							</Grid>
						</CollectionView.Header>
						<CollectionView.ItemTemplate>
							<DataTemplate x:DataType="view_model:ProductEditPageViewModel+BomEditItemViewModel">
								<Grid
									Padding="0,6"
									ColumnDefinitions="0.7*,0.3*"
									ColumnSpacing="8">
									<Picker
										ItemDisplayBinding="{Binding Name}"
										ItemsSource="{Binding BindingContext.MaterialOptions, Source={x:Reference ProductEditPageRoot}}"
										SelectedItem="{Binding Material}" />
									<Entry
										Grid.Column="1"
										HorizontalTextAlignment="End"
										Keyboard="Numeric"
										Text="{Binding Quantity}" />
								</Grid>
							</DataTemplate>
						</CollectionView.ItemTemplate>
					</CollectionView>
				</Border>
			</Grid>
		</Border>

		<Border Grid.Row="3">
			<Grid RowDefinitions="Auto,*" RowSpacing="8">
				<Grid ColumnDefinitions="0.8*,0.05*,0.05*,0.01*">
					<Label FontAttributes="Bold" Text="Производственные затраты" />
					<Button
						Grid.Column="1"
						Command="{Binding AddDepartmentCommand}"
						Text="+" />
					<Button
						Grid.Column="2"
						Command="{Binding RemoveDepartmentCommand}"
						IsEnabled="{Binding AreDepartmentSelected}"
						IsVisible="{Binding AreDepartmentSelected}"
						Text="-" />
				</Grid>

				<Border Grid.Row="1">
					<CollectionView
						x:Name="ProductionCostsEditCollection"
						Grid.Row="2"
						ItemsSource="{Binding EditableProductionCosts}"
						SelectionMode="None">
						<CollectionView.Header>
							<Grid
								Padding="0,4"
								ColumnDefinitions="0.3*,0.175*,0.175*,0.175*,0.175*"
								ColumnSpacing="8">
								<Label FontAttributes="Bold" Text="Цех" />
								<Label
									Grid.Column="1"
									FontAttributes="Bold"
									HorizontalTextAlignment="End"
									Text="Раскрой" />
								<Label
									Grid.Column="2"
									FontAttributes="Bold"
									HorizontalTextAlignment="End"
									Text="Пошив" />
								<Label
									Grid.Column="3"
									FontAttributes="Bold"
									HorizontalTextAlignment="End"
									Text="Упаковка" />
								<Label
									Grid.Column="4"
									FontAttributes="Bold"
									HorizontalTextAlignment="End"
									Text="Прочее" />
							</Grid>
						</CollectionView.Header>
						<CollectionView.ItemTemplate>
							<DataTemplate x:DataType="view_model:ProductEditPageViewModel+ProductionCostEditViewModel">
								<Grid
									Padding="0,6"
									ColumnDefinitions="0.3*,0.175*,0.175*,0.175*,0.175*"
									ColumnSpacing="8">
									<Picker
										ItemDisplayBinding="{Binding Name}"
										ItemsSource="{Binding BindingContext.DepartmentOptions, Source={x:Reference ProductEditPageRoot}}"
										SelectedItem="{Binding Department}" />
									<Entry
										Grid.Column="1"
										HorizontalTextAlignment="End"
										Keyboard="Numeric"
										Text="{Binding Cutting}" />
									<Entry
										Grid.Column="2"
										HorizontalTextAlignment="End"
										Keyboard="Numeric"
										Text="{Binding Sewing}" />
									<Entry
										Grid.Column="3"
										HorizontalTextAlignment="End"
										Keyboard="Numeric"
										Text="{Binding Packaging}" />
									<Entry
										Grid.Column="4"
										HorizontalTextAlignment="End"
										Keyboard="Numeric"
										Text="{Binding Other}" />
								</Grid>
							</DataTemplate>
						</CollectionView.ItemTemplate>
					</CollectionView>
				</Border>
			</Grid>
		</Border>
	</Grid>
</ContentPage>

