<ContentPage
    x:Class="MyFactory.MauiClient.Pages.Products.ProductEditPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.Products"
    x:Name="ProductEditPageRoot"
    Title="Редактирование товара"
    x:DataType="view_model:ProductEditPageViewModel">

    <Grid
        Padding="16"
        RowDefinitions="0.1*,0.2*,0.35*,0.35*"
        RowSpacing="12">
        <HorizontalStackLayout Grid.Row="0" Spacing="8">
            <Button Command="{Binding CancelCommand}" Text="Отмена" />
            <Button Command="{Binding SaveCommand}" Text="Сохранить" />
        </HorizontalStackLayout>

        <Grid
            Grid.Row="1"
            ColumnDefinitions="0.3*,0.7*"
            ColumnSpacing="8"
            RowDefinitions="0.5*,0.5*"
            RowSpacing="8">
            <Label FontAttributes="Bold" Text="Название:" />
            <Entry
                Grid.Column="1"
                Placeholder="Название"
                Text="{Binding Name}" />
            <Label
                Grid.Row="1"
                FontAttributes="Bold"
                Text="План/час:" />
            <Entry
                Grid.Row="1"
                Grid.Column="1"
                Keyboard="Numeric"
                Placeholder="План/час"
                Text="{Binding PlanPerHour}" />
        </Grid>

        <Border
            Grid.Row="2"
            Padding="8"
            Stroke="LightGray"
            StrokeThickness="1">
            <Grid RowDefinitions="0.14*,0.12*,0.74*" RowSpacing="8">
                <Grid
                    Grid.Row="0"
                    ColumnDefinitions="0.8*,0.2*"
                    ColumnSpacing="8">
                    <Label FontAttributes="Bold" Text="СПЕЦИФИКАЦИЯ" />
                    <Button
                        Grid.Column="1"
                        Command="{Binding AddMaterialCommand}"
                        Text="+" />
                </Grid>
                <Grid
                    Grid.Row="1"
                    Padding="0,4"
                    ColumnDefinitions="0.7*,0.3*"
                    ColumnSpacing="8">
                    <Label FontAttributes="Bold" Text="Материал" />
                    <Label
                        Grid.Column="1"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="End"
                        Text="Количество" />
                </Grid>
                <CollectionView
                    x:Name="BomEditCollection"
                    Grid.Row="2"
                    ItemsSource="{Binding EditableBom}"
                    SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="view_model:ProductEditPageViewModel+BomEditItemViewModel">
                            <Grid
                                Padding="0,6"
                                ColumnDefinitions="0.7*,0.3*"
                                ColumnSpacing="8">
                                <Picker
                                    ItemDisplayBinding="{Binding Name}"
                                    ItemsSource="{Binding BindingContext.MaterialOptions, Source={x:Reference ProductEditPageRoot}}"
                                    SelectedItem="{Binding Material}" />
                                <Entry
                                    Grid.Column="1"
                                    HorizontalTextAlignment="End"
                                    Keyboard="Numeric"
                                    Text="{Binding Quantity}" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Border>

        <Border
            Grid.Row="3"
            Padding="8"
            Stroke="LightGray"
            StrokeThickness="1">
            <Grid RowDefinitions="0.12*,0.16*,0.72*" RowSpacing="8">
                <Label
                    Grid.Row="0"
                    FontAttributes="Bold"
                    Text="Производственные затраты" />
                <Grid
                    Grid.Row="1"
                    Padding="0,4"
                    ColumnDefinitions="0.3*,0.175*,0.175*,0.175*,0.175*"
                    ColumnSpacing="8">
                    <Label FontAttributes="Bold" Text="Цех" />
                    <Label
                        Grid.Column="1"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="End"
                        Text="Раскрой" />
                    <Label
                        Grid.Column="2"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="End"
                        Text="Пошив" />
                    <Label
                        Grid.Column="3"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="End"
                        Text="Упаковка" />
                    <Label
                        Grid.Column="4"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="End"
                        Text="Прочее" />
                </Grid>
                <CollectionView
                    x:Name="ProductionCostsEditCollection"
                    Grid.Row="2"
                    ItemsSource="{Binding EditableProductionCosts}"
                    SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="view_model:ProductEditPageViewModel+ProductionCostEditViewModel">
                            <Grid
                                Padding="0,6"
                                ColumnDefinitions="0.3*,0.175*,0.175*,0.175*,0.175*"
                                ColumnSpacing="8">
                                <Picker
                                    ItemDisplayBinding="{Binding Name}"
                                    ItemsSource="{Binding BindingContext.DepartmentOptions, Source={x:Reference ProductEditPageRoot}}"
                                    SelectedItem="{Binding Department}" />
                                <Entry
                                    Grid.Column="1"
                                    HorizontalTextAlignment="End"
                                    Keyboard="Numeric"
                                    Text="{Binding Cutting}" />
                                <Entry
                                    Grid.Column="2"
                                    HorizontalTextAlignment="End"
                                    Keyboard="Numeric"
                                    Text="{Binding Sewing}" />
                                <Entry
                                    Grid.Column="3"
                                    HorizontalTextAlignment="End"
                                    Keyboard="Numeric"
                                    Text="{Binding Packaging}" />
                                <Entry
                                    Grid.Column="4"
                                    HorizontalTextAlignment="End"
                                    Keyboard="Numeric"
                                    Text="{Binding Other}" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Border>
    </Grid>
</ContentPage>

