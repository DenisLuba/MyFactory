<ContentPage
	x:Class="MyFactory.MauiClient.Pages.MaterialsAndSuppliers.Suppliers.SupplierDetailsPage"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
	xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.MaterialsAndSuppliers.Suppliers"
	Title="Карточка поставщика"
	x:DataType="view_model:SupplierDetailsPageViewModel">
	<Grid
		Padding="16"
		RowDefinitions="Auto,Auto,Auto,Auto,Auto,*"
		RowSpacing="12">
		<Label
			FontAttributes="Bold"
			FontSize="20"
			Text="{Binding Name}" />
		<Label Grid.Row="1" Text="{Binding Description}" />
		<Label Grid.Row="2" Text="{Binding Contacts}" />

		<HorizontalStackLayout Grid.Row="3" Spacing="12">
			<Button Command="{Binding EditCommand}" Text="Редактировать поставщика" />
			<Button Command="{Binding AddPurchaseCommand}" Text="Добавить закупку" />
			<Button
				Command="{Binding EditOrderCommand}"
				IsEnabled="{Binding HasSelection}"
				IsVisible="{Binding HasSelection}"
				Text="Редактировать заказ" />
			<Button
				Command="{Binding EditOrderCommand}"
				IsEnabled="{Binding HasSelectionForDetails}"
				IsVisible="{Binding HasSelectionForDetails}"
				Text="Детали заказа" />

			<Button
				Command="{Binding DeleteOrderCommand}"
				IsEnabled="{Binding HasSelection}"
				IsVisible="{Binding HasSelection}"
				Text="Удалить заказ" />
			<Button
				Command="{Binding BackCommand}"
				HorizontalOptions="End"
				Text="Назад" />
		</HorizontalStackLayout>

		<Grid
			Grid.Row="4"
			ColumnDefinitions="*,*,*,Auto,Auto"
			ColumnSpacing="8">
			<Entry Placeholder="Поиск по типу материала" Text="{Binding MaterialTypeFilter, Mode=TwoWay}" />
			<Entry
				Grid.Column="1"
				Placeholder="Поиск по материалу"
				Text="{Binding MaterialNameFilter, Mode=TwoWay}" />
			<Picker
				Title="Статус"
				Grid.Column="2"
				ItemsSource="{Binding StatusOptions}"
				SelectedItem="{Binding SelectedStatus, Mode=TwoWay}" />
			<VerticalStackLayout Grid.Column="3">
				<Label Text="От" />
				<DatePicker Date="{Binding FromDateFilter, Mode=TwoWay}" Format="dd.MM.yyyy" />
			</VerticalStackLayout>
			<VerticalStackLayout Grid.Column="4">
				<Label Text="До" />
				<DatePicker Date="{Binding ToDateFilter, Mode=TwoWay}" Format="dd.MM.yyyy" />
			</VerticalStackLayout>

		</Grid>

		<Border
			Grid.Row="5"
			Padding="8"
			Stroke="LightGray"
			StrokeThickness="1">
			<Grid RowDefinitions="Auto,*" RowSpacing="8">
				<Label FontAttributes="Bold" Text="История закупок" />

				<Grid
					Grid.Row="1"
					RowDefinitions="Auto,*"
					RowSpacing="8">
					<Grid
						Padding="0,4"
						ColumnDefinitions="1.2*,1.2*,0.8*,0.8*,0.9*,0.9*,0.1*"
						ColumnSpacing="8">
						<Label FontAttributes="Bold" Text="Тип" />
						<Label
							Grid.Column="1"
							FontAttributes="Bold"
							Text="Материал" />
						<Label
							Grid.Column="2"
							FontAttributes="Bold"
							HorizontalTextAlignment="End"
							Text="Кол-во" />
						<Label
							Grid.Column="3"
							FontAttributes="Bold"
							HorizontalTextAlignment="End"
							Text="Цена" />
						<Label
							Grid.Column="4"
							FontAttributes="Bold"
							HorizontalTextAlignment="End"
							Text="Статус" />
						<Label
							Grid.Column="5"
							FontAttributes="Bold"
							HorizontalTextAlignment="End"
							Text="Дата" />
					</Grid>

					<CollectionView
						Grid.Row="1"
						ItemsSource="{Binding PurchaseHistory}"
						SelectedItem="{Binding SelectedPurchase, Mode=TwoWay}"
						SelectionMode="Single">
						<CollectionView.ItemTemplate>
							<DataTemplate x:DataType="view_model:SupplierDetailsPageViewModel+SupplierPurchaseHistoryItemViewModel">
								<Grid
									Padding="0,6"
									ColumnDefinitions="1.2*,1.2*,0.8*,0.8*,0.9*,0.9*,0.1*"
									ColumnSpacing="8"
									Style="{StaticResource SelectableItemGridStyle}">
									<Label Text="{Binding MaterialType}" />
									<Label Grid.Column="1" Text="{Binding MaterialName}" />
									<Label
										Grid.Column="2"
										HorizontalTextAlignment="End"
										Text="{Binding Qty}" />
									<Label
										Grid.Column="3"
										HorizontalTextAlignment="End"
										Text="{Binding UnitPrice}" />
									<Label
										Grid.Column="4"
										HorizontalTextAlignment="End"
										Text="{Binding StatusText}" />
									<Label
										Grid.Column="5"
										HorizontalTextAlignment="End"
										Text="{Binding Date, StringFormat='{0:d}'}" />
								</Grid>
							</DataTemplate>
						</CollectionView.ItemTemplate>
					</CollectionView>
				</Grid>
			</Grid>
		</Border>
	</Grid>
</ContentPage>

