<ContentPage
	x:Class="MyFactory.MauiClient.Pages.MaterialsAndSuppliers.Materials.MaterialDetailsEditPage"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
	xmlns:view_model="clr-namespace:MyFactory.MauiClient.ViewModels.MaterialsAndSuppliers.Materials"
	Title="Редактирование материала"
	x:DataType="view_model:MaterialDetailsEditPageViewModel">

	<Grid
		Padding="16"
		RowDefinitions="Auto,Auto,*"
		RowSpacing="12">
		<Grid
			ColumnDefinitions="Auto,*"
			ColumnSpacing="8"
			RowDefinitions="Auto,Auto,Auto,Auto"
			RowSpacing="8">
			<Label FontAttributes="Bold" Text="Материал:" />
			<Entry
				Grid.Column="1"
				Placeholder="Название"
				Text="{Binding Name}" />
			<Label
				Grid.Row="1"
				FontAttributes="Bold"
				Text="Тип:" />
			<Picker
				Grid.Row="1"
				Grid.Column="1"
				ItemsSource="{Binding MaterialTypes}"
				SelectedItem="{Binding SelectedMaterialType}" />
			<Label
				Grid.Row="2"
				FontAttributes="Bold"
				Text="Единицы измерения: " />
			<Picker
				Grid.Row="2"
				Grid.Column="1"
				ItemsSource="{Binding Units}"
				SelectedItem="{Binding SelectedUnit}" />
			<Label
				Grid.Row="3"
				FontAttributes="Bold"
				Text="Цвет:" />
			<Entry
				Grid.Row="3"
				Grid.Column="1"
				Placeholder="Цвет"
				Text="{Binding Color}" />
		</Grid>

		<HorizontalStackLayout Grid.Row="1" Spacing="8">
			<Button Command="{Binding SaveCommand}" Text="Сохранить" />
			<Button Command="{Binding CancelCommand}" Text="Отменить" />
		</HorizontalStackLayout>

		<Border
			Grid.Row="2"
			Padding="8"
			Stroke="LightGray"
			StrokeThickness="1">

			<Grid RowDefinitions="Auto,*" RowSpacing="8">

				<Grid Grid.Row="0">
					<Label FontAttributes="Bold" Text="История закупок" />
					<Button
						Command="{Binding AddPurchaseRowCommand}"
						HorizontalOptions="End"
						Text="Добавить" />
				</Grid>

				<CollectionView
					x:Name="PurchaseHistoryEditCollection"
					Grid.Row="1"
					ItemsSource="{Binding EditablePurchaseHistory}"
					SelectionMode="None">
					<CollectionView.Header>

						<Grid
							Padding="0,4"
							ColumnDefinitions="*,120,80,120"
							ColumnSpacing="8">

							<Label FontAttributes="Bold" Text="Поставщик" />
							<Label
								Grid.Column="1"
								FontAttributes="Bold"
								HorizontalTextAlignment="End"
								Text="Кол-во" />
							<Label
								Grid.Column="2"
								FontAttributes="Bold"
								HorizontalTextAlignment="End"
								Text="Цена" />
							<Label
								Grid.Column="3"
								FontAttributes="Bold"
								HorizontalTextAlignment="End"
								Text="Дата" />
						</Grid>
					</CollectionView.Header>

					<CollectionView.ItemTemplate>
						<DataTemplate x:DataType="view_model:MaterialDetailsEditPageViewModel+EditablePurchaseItemViewModel">

							<Grid
								Padding="0,6"
								ColumnDefinitions="*,120,80,120"
								ColumnSpacing="8"
								Style="{StaticResource SelectableItemGridStyle}">
								<Grid.GestureRecognizers>
									<TapGestureRecognizer Command="{Binding BindingContext.EditPurchaseCommand, Source={x:Reference Name=PurchaseHistoryEditCollection}}" CommandParameter="{Binding .}" />
								</Grid.GestureRecognizers>
								<Picker
									ItemDisplayBinding="{Binding Name}"
									ItemsSource="{Binding SupplierOptions}"
									SelectedItem="{Binding Supplier}" />
								<HorizontalStackLayout
									Grid.Column="1"
									HorizontalOptions="End"
									Spacing="4">
									<Entry
										HorizontalTextAlignment="End"
										Keyboard="Numeric"
										Text="{Binding Qty}"
										WidthRequest="80" />
									<Label Text="{Binding BindingContext.UnitCode, Source={x:Reference Name=PurchaseHistoryEditCollection}}" VerticalTextAlignment="Center" />
								</HorizontalStackLayout>
								<Entry
									Grid.Column="2"
									HorizontalTextAlignment="End"
									Keyboard="Numeric"
									Text="{Binding UnitPrice}" />
								<DatePicker
									Grid.Column="3"
									Date="{Binding PurchaseDate}"
									HorizontalOptions="End" />
							</Grid>
						</DataTemplate>
					</CollectionView.ItemTemplate>
				</CollectionView>
			</Grid>
		</Border>

	</Grid>

</ContentPage>

